\subsection{Trabalhos Relacionados}\label{subsec:estudo-de-caso-base}


A previsão da demanda de água é uma preocupação fundamental para muitas organizações e autoridades responsáveis pelo abastecimento de água. A análise de séries temporais é uma abordagem comumente usada para prever padrões futuros com base em dados históricos. Neste estudo de caso, será explorado como a análise de séries temporais pode ser aplicada para prever a demanda de água ao longo do tempo.



\subsubsection{Defini\c c\~ao do problema}



Na subseção \ref{subsubsec:obespec} estão as perguntas de pesquisa que serão abordadas no estudo de caso, da pergunta \ref{q1} à \ref{q5}, com as ramificações da \ref{q5}.

\subsubsection{Coleta de dados}


Na subseção \ref{subsec:descricao}, são apresentadas as variáveis contidas no conjunto de dados coletado no período de 2018 a 2020, durante uma grave falta de água que afetou a cidade. Devido a essa situação, foi implementado um rodízio de abastecimento de água para os residentes. Os dados foram coletados em intervalos de uma hora, levando em consideração cada variável, com ênfase na variável-alvo, denominada LT01, que representa o nível do reservatório.

O conjunto de dados possui um total de 26.306 linhas e 9 colunas. Durante a coleta dos dados, verificou-se que eles apresentam padrões sazonais, indicando variações recorrentes ao longo do tempo. Além disso, constatou-se que o consumo diário foi significativamente afetado no ano de 2020, diferindo dos anos anteriores, nos quais as mudanças não foram tão significativas.



\subsubsection{An\'alise explorat\'oria dos dados}



Ao longo do trabalho realizado, pôde-se observar na subseção \ref{subsec:detec} que foi realizada uma análise gráfica do problema antes da aplicação de qualquer método. A detecção de anomalias mostrou-se desafiadora, porém não impossível de ser realizada. Essa detecção permitiu a análise da presença de sazonalidade nos dados. A decomposição STL foi utilizada para essa finalidade, conforme descrito na etapa \ref{etp:3} e detalhado na subseção \ref{subsubsec:stl}, onde são apresentadas as decomposições realizadas.

É fundamental lembrar que, durante a análise exploratória, os dados sofreram algumas alterações. Por exemplo, a média diária foi calculada em vez de ser considerada a nível horário, resultando em uma redução do conjunto de dados de 26.306 linhas para 1.096 linhas. A decomposição STL foi aplicada nos formatos aditivo e multiplicativo, e ambas as abordagens estão ilustradas nas Figuras \ref{fig:stl-aditiva} e \ref{fig:stl}, respectivamente.

Adicionalmente, na subseção \ref{subsubsec:stl}, foi realizada a verificação da estacionariedade da série. O teste de Dickey-Fuller (DF) foi empregado para auxiliar na tomada de decisões, e os resultados demonstraram que a série em análise é estacionária, conforme evidenciado pelo teste DF.



\subsubsection{Escolha do modelo}



Dentro da análise, foram incluídos uma variedade de modelos para melhor capturar a natureza dos dados e aprimorar as previsões. Esses modelos incluem:

\begin{description}
	\item [RNN (Rede Neural Recorrente),] que leva em conta as dependências sequenciais nos dados para prever valores futuros.

	\item [LSTM (Long Short-Term Memory),] um tipo de RNN que lida especialmente bem com sequências longas e dependências de longo prazo.

	\item [GRU (Gated Recurrent Unit),] outra variante de RNN que equilibra o poder de modelagem e a eficiência computacional.

	\item [Transformer,] um modelo amplamente utilizado para tarefas de processamento de linguagem natural e sequências, que também pode ser adaptado para previsões sequenciais.

	\item [Prophet,] um modelo de previsão desenvolvido pelo Facebook que lida bem com dados sazonais e tendências.

	\item [Decision Tree Regressor,] um modelo baseado em árvore de decisão que segmenta os dados em subgrupos para fazer previsões.

Esses modelos são complementados com abordagens tradicionais como:

	\item [Modelos de séries temporais univariados,] incluindo AR, MA, ARMA, ARIMA e SARIMA, que levam em consideração a sazonalidade dos dados.

	\item [Modelos de séries temporais multivariados,] como ARX, ARIMAX e SARIMAX, que incorporam variáveis exógenas para melhorar as previsões.

Além disso, foram explorados modelos de aprendizado de máquina supervisionados:

	\item [LR (\textit{Regressão Linear}),] que estabelece relações lineares entre variáveis para fazer previsões.

	\item [RFR (\textit{Random Forest Regressor}),] um \textit{ensemble} de árvores de decisão que captura complexas relações nos dados.

	\item [LightGBM e XGBoost,] modelos baseados em \textit{gradient boosting} que são reconhecidos por sua eficácia na previsão e tomada de decisões. O XGBoost é particularmente conhecido por seu desempenho superior em várias métricas de avaliação.

\end{description}

A inclusão desses modelos permite uma abordagem abrangente à previsão, aproveitando as vantagens específicas de cada método para lidar com diferentes aspectos dos dados e melhorar as previsões em um conjunto diversificado de cenários.



\subsubsection{Divis\~ao dos dados}


Para obter a divisão mais adequada dos dados, verificam-se a média e o desvio padrão de cada um desses conjuntos. O conjunto de dados é dividido em três partes: treinamento, validação e teste. Nessa divisão, utiliza-se inicialmente 70\% dos dados para treinamento e validação, e os 30\% restantes para teste. Em seguida, a porção de treinamento e validação é subdividida em 80\% para treinamento e 20\% para validação.

\subsubsection{Ajuste do modelo}
Nesta etapa, você aplicará o modelo selecionado aos dados de treinamento. Ajuste os parâmetros do modelo com o objetivo de minimizar os erros de previsão. Dependendo do modelo escolhido, você pode usar técnicas de otimização para encontrar os melhores parâmetros.

Ao ajustar o modelo para a base de dados, foi feita uma alteração na ordem do modelo sugerido pelo pmdarima. A escolha foi trocar o modelo SARIMAX(1,1,1)(2,1,0,12) para SARIMAX(7,1,7)(2,1,0,12). Essa decisão foi tomada com base na observação de um ajuste mais preciso aos dados, evidenciado pela redução nos resíduos e uma melhor captura das características da série temporal. Além disso, considerando o conhecimento do problema e as características específicas dos dados, foi identificado que padrões mais complexos requeriam ordens mais altas para serem adequadamente capturados. Dessa forma, foi realizado um processo iterativo de experimentação e avaliação para determinar o modelo SARIMAX(7,1,7)(2,1,0,12) como o mais adequado para a base de dados em questão. É importante ressaltar que o desempenho do novo modelo será avaliado por meio de diagnósticos adicionais e análise dos resultados obtidos.

Os modelos RNN, LSTM e GRU foram ajustados minuciosamente por meio da técnica de otimização de hiperparâmetros do Optuna, permitindo uma exploração adaptativa e eficiente do espaço de configurações. Essa abordagem exclusiva do Optuna resultou em modelos sequenciais com aprimoramento notável na capacidade preditiva. Parâmetros vitais, como taxa de aprendizado, tamanho da camada oculta e número de unidades, foram otimizados de forma eficaz através do Optuna.

O Random Forest Regressor (RFR) apresentou melhorias notáveis após o ajuste com o Optuna. A otimização realizada pelo Optuna permitiu identificar uma combinação de hiperparâmetros ideal para o RFR, resultando em um significativo aprimoramento no desempenho preditivo desse modelo.

No entanto, o modelo Transformer e o Prophet não puderam ser otimizados com sucesso por meio do Optuna. Apesar das tentativas de ajuste, as melhorias significativas não foram observadas em seus resultados. Estes modelos mantiveram suas configurações padrão, uma vez que os esforços de otimização com o Optuna não resultaram em ganhos substanciais.

Considerando que o modelo LR (Regressão Linear) não demonstrou melhorias significativas, uma decisão foi tomada para substituí-lo pelo modelo Decision Tree Regressor. Este último foi ajustado empregando o Optuna, buscando encontrar a configuração de hiperparâmetros ideal para o modelo de árvore de decisão. Essa decisão foi respaldada pelo fato de que o Optuna havia demonstrado ser uma ferramenta eficaz para otimização de hiperparâmetros, como evidenciado pelas melhorias observadas no RFR e em outros modelos.

Dessa forma, os modelos RNN, LSTM, GRU, XGBRegressor, LGBMRegressor e o Decision Tree Regressor foram todos otimizados com sucesso utilizando o Optuna, resultando em previsões mais robustas e confiáveis. No entanto, os modelos Transformer e Prophet mantiveram suas configurações originais devido à ausência de melhorias substanciais após tentativas de otimização com o Optuna.

O \textbf{Optuna} oferece uma abordagem de otimização de hiperparâmetros mais avançada e eficaz em comparação com outras técnicas amplamente utilizadas, como o GridSearchCV, BayesSearchCV e RandomizedSearchCV. Enquanto essas abordagens tradicionais têm suas vantagens, o Optuna leva a otimização de hiperparâmetros a um nível superior.

O \textbf{GridSearchCV}, por exemplo, é uma técnica exaustiva que explora todas as combinações possíveis de hiperparâmetros. Embora seja abrangente, essa abordagem pode se tornar computacionalmente intensiva e demorada, especialmente quando o espaço de busca é grande. Além disso, o GridSearchCV não considera a interação entre os hiperparâmetros, o que pode limitar sua capacidade de encontrar combinações ótimas.

O \textbf{BayesSearchCV} melhora a eficiência em relação ao GridSearchCV usando otimização bayesiana, mas ainda enfrenta limitações. Ele utiliza um processo de amostragem sequencial com um modelo probabilístico para explorar o espaço de hiperparâmetros de maneira mais inteligente. No entanto, o BayesSearchCV ainda pode exigir muitas iterações para encontrar configurações ideais, especialmente em espaços de busca complexos.

O \textbf{RandomizedSearchCV}, por outro lado, busca aleatoriamente subconjuntos do espaço de hiperparâmetros. Isso pode ser útil para espaços de busca vastos, mas ainda não garante uma exploração eficaz do espaço para encontrar as melhores configurações.

Aqui é onde o Optuna se destaca. Utilizando algoritmos avançados de otimização, o Optuna oferece uma abordagem mais inteligente e eficiente para encontrar as configurações ideais de hiperparâmetros. Ele emprega técnicas de amostragem adaptativa, como o algoritmo TPE (Tree-structured Parzen Estimator), para direcionar a pesquisa para as áreas mais promissoras do espaço de hiperparâmetros. Isso permite uma exploração mais eficaz e uma descoberta mais rápida das configurações que maximizam a métrica de avaliação.

Além disso, o Optuna é altamente flexível e pode ser facilmente integrado a diversos algoritmos e frameworks de aprendizado de máquina. Sua abordagem adaptativa e inteligente proporciona economia de recursos computacionais e, ao mesmo tempo, aumenta as chances de encontrar configurações de hiperparâmetros que levem a um desempenho superior do modelo.

Em resumo, o Optuna supera as abordagens tradicionais, como o GridSearchCV, BayesSearchCV e RandomizedSearchCV, oferecendo uma otimização de hiperparâmetros mais eficiente, inteligente e adaptativa. Sua capacidade de explorar de maneira direcionada o espaço de hiperparâmetros resulta em uma descoberta mais rápida das configurações ideais, impulsionando o desempenho dos modelos de aprendizado de máquina de forma significativa.

\subsubsection{Avalia\c c\~ao do modelo}


A avaliação da precisão dos modelos de previsão é uma etapa fundamental no processo de modelagem. Diversas métricas podem ser utilizadas para esse propósito, como o sMAPE, o MAE e o RRMSE. Essas métricas têm sido amplamente adotadas na literatura de previsão e são consideradas indicadores confiáveis para mensurar a qualidade das previsões.

De acordo com \citeonline{zhang2016}, o MAPE é uma métrica bastante utilizada na avaliação de modelos de previsão, especialmente quando há variações significativas nos dados ou quando se deseja comparar a precisão de diferentes modelos. O MAPE calcula o erro médio percentual entre as previsões e os valores reais, fornecendo uma medida relativa da precisão do modelo.

De acordo com \citeonline{willmott2005advantages}, o uso do erro médio absoluto (MAE) apresenta vantagens na avaliação do desempenho médio de um modelo, em comparação com o erro quadrático médio (RMSE).

\citeonline{jones2017} destacam a importância do RMSE na avaliação de modelos e argumentam contra a exclusão dessa métrica na literatura.


O RRMSE é uma métrica de avaliação altamente eficaz para medir a precisão relativa de modelos de regressão. Eles destacam que sua normalização em relação à média dos valores reais permite uma interpretação intuitiva e facilita a comparação entre diferentes modelos. Segundo os autores, o RRMSE é amplamente utilizado na literatura devido à sua capacidade de fornecer uma medida robusta e padronizada da precisão dos modelos de regressão \cite{lopes2020evaluation}. Segundo \citeonline{peng2017effective}, o MAPE é amplamente utilizado na avaliação de modelos de previsão, especialmente quando há variações significativas nos dados ou quando se deseja comparar a precisão de diferentes modelos.

O sMAPE é uma métrica amplamente utilizada para avaliar a precisão de modelos de previsão. Eles afirmam que o sMAPE possui algumas vantagens, como a consideração da simetria dos erros percentuais e a interpretação intuitiva como uma medida de precisão relativa \cite{nguyen2020toxicological}.

Além disso, \citeonline{jones2017} afirmam que o MAE e o RMSE são métricas amplamente adotadas na análise de previsões, pois fornecem uma medida direta do desvio absoluto e do desvio quadrático médio entre as previsões e os valores observados. O MAE é particularmente útil quando se busca uma medida de erro que não seja sensível a valores extremos, enquanto o RMSE penaliza de forma mais significativa os erros maiores, oferecendo uma visão mais abrangente da precisão do modelo.

O sMAPE é uma métrica de avaliação popular para comparar a precisão de diferentes modelos de previsão. Eles destacam que o sMAPE é particularmente útil quando os valores de demanda têm diferentes magnitudes, pois captura os erros relativos em uma escala percentual. Além disso, o sMAPE possui uma interpretação intuitiva e facilita a comparação entre modelos de previsão \cite{hyndman2006effect}.


Portanto, ao utilizar essas métricas, o pesquisador estará seguindo uma prática comum e fundamentada na literatura. O sMAPE permitirá avaliar a precisão relativa das previsões, enquanto o MAE e o RRMSE fornecerão uma medida direta dos desvios absolutos e quadráticos, respectivamente. Essas métricas fornecerão uma base sólida para a avaliação dos modelos de previsão utilizados na pesquisa.


\subsubsection{Previs\~oes Futuras}


Com base nos modelos AR, ARX, MA, ARMA, ARIMA, ARMAX, SARIMA, SARIMAX,  XGBRegressor, LGBMRegressor, RNN, LSTM, GRU, Transformer, Prophet e Decision Tree Regressor, que foram cuidadosamente aplicados e avaliados, é possível afirmar que uma vez que a precisão desses modelos tenha sido satisfatória, eles podem ser utilizados para fazer previsões futuras. Ao aplicar esses modelos aos dados futuros disponíveis, ele poderá estimar a demanda de água para diferentes horizontes de previsão, como um dia, uma semana, duas semanas e um mês.

Essas previsões fornecerão informações valiosas para o planejamento e gerenciamento eficiente dos recursos hídricos. Ao ter conhecimento antecipado da demanda de água esperada nos próximos períodos, será possível adotar medidas adequadas para garantir o suprimento apropriado de água, prevenir escassez ou desperdício e realizar um planejamento eficaz para a distribuição e uso dos recursos hídricos.

Com base nos resultados significativos obtidos por esses modelos durante o processo de validação, o pesquisador terá confiança em aplicá-los para previsões futuras de curto prazo. Essas previsões permitirão a compreensão das tendências e variações na demanda de água ao longo de diferentes períodos, capacitando os responsáveis pela gestão dos recursos hídricos a tomar decisões informadas e estratégicas.

Portanto, uma vez que os modelos tenham sido devidamente avaliados e demonstrado sua eficácia, eles podem ser utilizados para fazer previsões precisas da demanda de água em horizontes de previsão de um dia, uma semana, duas semanas e um mês, contribuindo para a gestão e planejamento eficiente dos recursos hídricos.

\subsubsection{Monitoramento e Ajuste Cont\'inuo}


É importante destacar que todas as questões de pesquisa abordadas neste estudo estão fundamentadas no fator dos horários de pico e nas anomalias que ocorreram durante o período analisado. O comportamento da demanda de água durante os horários de maior consumo e as anomalias observadas foram aspectos-chave que motivaram a realização desta pesquisa.

Ao investigar os efeitos dos horários de pico e das anomalias na demanda de água, o estudo teve como objetivo compreender melhor os padrões de consumo, identificar possíveis causas para as variações significativas na demanda e desenvolver modelos de previsão mais precisos. A análise desses aspectos contribuiu para uma melhor compreensão dos desafios enfrentados no abastecimento de água e na gestão dos recursos hídricos durante os períodos críticos.

Considerando a importância desses fatores na formulação das questões de pesquisa, as análises realizadas e os modelos desenvolvidos buscaram fornecer insights e informações relevantes para aprimorar a capacidade de previsão e planejamento do abastecimento de água, especialmente durante os horários de pico e diante de anomalias observadas.

\subsubsection{Principais Conclus\~ao}


Ao longo deste estudo de caso, foram resolvidas as questões de pesquisa levantadas por meio da aplicação da análise de séries temporais para prever a demanda de água. A abordagem adotada demonstrou ser eficaz na obtenção de insights valiosos para o gerenciamento do abastecimento hídrico.

Foi constatado que a análise de séries temporais é uma ferramenta promissora para prever a demanda de água, permitindo tomar decisões informadas e embasadas nesse contexto. Por meio da modelagem e aplicação de diversos modelos, como ARIMA, SARIMA e outros, foi possível analisar e interpretar os dados históricos de maneira precisa, obtendo previsões confiáveis.

Durante o estudo, foram levantadas questões relacionadas à sazonalidade da demanda de água, influência de fatores externos imprevisíveis e mudanças no comportamento dos consumidores. Através da adaptação das técnicas de análise de séries temporais, foi possível abordar essas questões de forma eficiente e obter respostas relevantes para o gerenciamento do abastecimento de água.

Ao longo do processo, foram identificadas anomalias e flutuações na demanda de água, bem como tendências sazonais específicas. Por meio da análise dos resultados obtidos com os modelos aplicados, foi possível ajustar e aprimorar as previsões, tornando-as mais acuradas e confiáveis.

Em suma, este estudo de caso demonstrou que a análise de séries temporais é uma abordagem eficaz para prever a demanda de água, permitindo uma gestão mais eficiente do abastecimento hídrico. Ao adaptar e aplicar as técnicas adequadas aos dados específicos e às características do contexto, foram resolvidas as questões de pesquisa propostas e obtidos resultados significativos.

Essas descobertas têm o potencial de contribuir para a tomada de decisões embasadas no planejamento e no gerenciamento da demanda de água, visando a sustentabilidade e a eficiência dos recursos hídricos.

\section{Resultados} \label{sec:result}

Neste capítulo, é fornecida uma síntese e uma visão geral dos resultados obtidos até o momento. É apresentado um resumo sucinto das principais realizações e descobertas que foram alcançadas até agora.


\subsection{Planejamento do Problema} \label{subsec:planexp}

Assim como apresentado na seção \ref{subsubsec:etp}, os passos da dissertação delinearam o processo pelo qual cada modelo foi construído e os métodos utilizados para responder às questões de pesquisa abordadas na seção \ref{subsubsec:obespec}. Esses passos proporcionaram uma cronologia lógica das etapas realizadas ao longo do tempo com os dados da SANEPAR, ilustrando o progresso e os resultados alcançados até o momento.


\input{Resultados/subsubsec-eda}

\input{Resultados/subsubsec-miso}

\input{Resultados/subsubsec-stl}

\input{Resultados/subsubsec-divisao}

\input{Resultados/subsubsec-estrategia}

\input{Resultados/subsubsec-horizonte}

\input{Resultados/subsubsec-model}

\input{Resultados/subsubsec-test}

\input{Resultados/subsubsec-comparacao}  

\input{Resultados/subsec-estudo} 


